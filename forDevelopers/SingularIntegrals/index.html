



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="http://homerreid.github.io/scuff-em-documentation/forDevelopers/SingularIntegrals/">
      
      
        <meta name="author" content="Homer Reid">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.3">
    
    
      
        <title>Code for computing singular integrals - SCUFF-EM documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.8d40d89b.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,400,400i,700|">
        <style>body,input{font-family:"Noto Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/scuff-em.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#2-c-calling-convention" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://homerreid.github.io/scuff-em-documentation" title="SCUFF-EM documentation" class="md-header-nav__button md-logo">
          
            <img src="../../reference/scuffEMLogo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                SCUFF-EM documentation
              </span>
              <span class="md-header-nav__topic">
                Code for computing singular integrals
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/homerreid/scuff-em/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      scuff-em
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../examples/" title="Examples" class="md-tabs__link">
          Examples
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../tests/Overview/" title="Test suite" class="md-tabs__link">
          Test suite
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../reference/TopLevel/" title="General reference" class="md-tabs__link">
          General reference
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../applications/GeneralReference/" title="Command-line tools" class="md-tabs__link">
          Command-line tools
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../HighLevelInterface/HighLevelInterface/" title="High-level interface" class="md-tabs__link">
          High-level interface
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../API/libscuff/" title="Low-level API" class="md-tabs__link">
          Low-level API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../Implementation/" title="For developers" class="md-tabs__link md-tabs__link--active">
          For developers
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../reference/scuffEMLogo.png" width="48" height="48">
      
    </span>
    SCUFF-EM documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/homerreid/scuff-em/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      scuff-em
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/" title="SCUFF-EM tutorial examples" class="md-nav__link">
      SCUFF-EM tutorial examples
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/MieScattering/MieScattering/" title="Mie scattering" class="md-nav__link">
      Mie scattering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/DielectricShell/DielectricShell/" title="Electrostatics of a spherical dielectric shell" class="md-nav__link">
      Electrostatics of a spherical dielectric shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/ThinFilm/ThinFilm/" title="Spatially-resolved study of plane-wave transmission through an infinite-area thin dielectric film" class="md-nav__link">
      Spatially-resolved study of plane-wave transmission through an infinite-area thin dielectric film
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/DiffractionPatterns/DiffractionPatterns/" title="Imaging diffraction patterns of discs, disc arrays, and hole arrays in metal screens" class="md-nav__link">
      Imaging diffraction patterns of discs, disc arrays, and hole arrays in metal screens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/NanorodResonantModes/NanorodResonantModes/" title="Mode frequencies and field patterns of resonant modes in gold nanorods" class="md-nav__link">
      Mode frequencies and field patterns of resonant modes in gold nanorods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/CubeTorus/" title="Casimir forces in a compact geometry" class="md-nav__link">
      Casimir forces in a compact geometry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/SiliconBeams/SiliconBeams/" title="Casimir forces in a 1D extended geometry" class="md-nav__link">
      Casimir forces in a 1D extended geometry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/SiliconSlabs/SiliconSlabs/" title="Casimir forces in a 2D extended geometry" class="md-nav__link">
      Casimir forces in a 2D extended geometry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/NanostructureCasimirPolder/NanostructureCasimirPolder/" title="Casimir-Polder potentials in dielectric nanostructures" class="md-nav__link">
      Casimir-Polder potentials in dielectric nanostructures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/SiO2Spheres/SiO2Spheres/" title="Thermal radiation, heat transfer, and non-equilibrium Casimir forces between silicon dioxide spheres" class="md-nav__link">
      Thermal radiation, heat transfer, and non-equilibrium Casimir forces between silicon dioxide spheres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/TipSubstrate/TipSubstrate/" title="Spatial distribution of heat flux from a warm tip over a cold substrate" class="md-nav__link">
      Spatial distribution of heat flux from a warm tip over a cold substrate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/HalfSpaceLDOS/HalfSpaceLDOS/" title="LDOS and dyadic Green functions above an infinite aluminum half-space" class="md-nav__link">
      LDOS and dyadic Green functions above an infinite aluminum half-space
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/PlatonicSolids/PlatonicSolids/" title="Electrostatic polarizability of platonic solids" class="md-nav__link">
      Electrostatic polarizability of platonic solids
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/TwoBodyCapacitors/TwoBodyCapacitors/" title="Capacitance of two-body capacitors" class="md-nav__link">
      Capacitance of two-body capacitors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/StriplineCapacitor/StriplineCapacitor/" title="Capacitance of a PCB stripline trace" class="md-nav__link">
      Capacitance of a PCB stripline trace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/ImplicitSubstrate/ImplicitSubstrate/" title="Implicit handling of multilayer dielectric substrates" class="md-nav__link">
      Implicit handling of multilayer dielectric substrates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/pythonCapacitance/pythonCapacitance/" title="Finite-size effects in stripline capacitors" class="md-nav__link">
      Finite-size effects in stripline capacitors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/PaulTrap/PaulTrap/" title="Electrostatic fields of an electrode array" class="md-nav__link">
      Electrostatic fields of an electrode array
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/YagiUdaAntennas/YagiUdaAntennas/" title="Z-parameters and directivity of Yagi-Uda antennas" class="md-nav__link">
      Z-parameters and directivity of Yagi-Uda antennas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/MicrostripDevices/MicrostripDevices/" title="Input impedance, mutual coupling, and radiated fields of microstrip RF devices" class="md-nav__link">
      Input impedance, mutual coupling, and radiated fields of microstrip RF devices
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Test suite
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Test suite
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/Overview/" title="Overview of the test suite" class="md-nav__link">
      Overview of the test suite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/MieScattering/MieScattering/" title="Mie scattering" class="md-nav__link">
      Mie scattering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/FresnelScattering/FresnelScattering/" title="Fresnel scattering" class="md-nav__link">
      Fresnel scattering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/CasimirSpheres/CasimirSpheres/" title="Equilibrium Casimir forces between spheres" class="md-nav__link">
      Equilibrium Casimir forces between spheres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/CasimirPlates/CasimirPlates/" title="Equilibrium Casimir forces between plates" class="md-nav__link">
      Equilibrium Casimir forces between plates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/CPSphere/CPSphere/" title="Equilibrium Casimir-Polder potential near a sphere" class="md-nav__link">
      Equilibrium Casimir-Polder potential near a sphere
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/CPPlate/CPPlate/" title="Equilibrium Casimir-Polder potential near a plate" class="md-nav__link">
      Equilibrium Casimir-Polder potential near a plate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/NEQSpheres/NEQSpheres/" title="Heat transfer and non-equilibrium Casimir forces between spheres" class="md-nav__link">
      Heat transfer and non-equilibrium Casimir forces between spheres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/libscuff/libscuff/" title="Low-level tests of the core library" class="md-nav__link">
      Low-level tests of the core library
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      General reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        General reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/TopLevel/" title="Top-level overview" class="md-nav__link">
      Top-level overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Installing/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Geometries/" title="Geometry descriptions" class="md-nav__link">
      Geometry descriptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/EquivalentEdgeSurfacePairs/" title="Equivalent edge/surface pairs" class="md-nav__link">
      Equivalent edge/surface pairs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Materials/" title="Material designations" class="md-nav__link">
      Material designations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Transformations/" title="Geometric transformations" class="md-nav__link">
      Geometric transformations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/IncidentFields/" title="Incident fields" class="md-nav__link">
      Incident fields
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/BrillouinZoneIntegration/" title="Brillouin zone integration" class="md-nav__link">
      Brillouin zone integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/FAQ/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Command-line tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Command-line tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/GeneralReference/" title="General command-line reference" class="md-nav__link">
      General command-line reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-scatter/scuff-scatter/" title="scuff-scatter" class="md-nav__link">
      scuff-scatter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-transmission/scuff-transmission/" title="scuff-transmission" class="md-nav__link">
      scuff-transmission
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-ldos/scuff-ldos/" title="scuff-ldos" class="md-nav__link">
      scuff-ldos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-tmatrix/scuff-tmatrix/" title="scuff-tmatrix" class="md-nav__link">
      scuff-tmatrix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-cas3D/scuff-cas3D/" title="scuff-cas3D" class="md-nav__link">
      scuff-cas3D
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-caspol/scuff-caspol/" title="scuff-caspol" class="md-nav__link">
      scuff-caspol
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-neq/scuff-neq/" title="scuff-neq" class="md-nav__link">
      scuff-neq
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-rf/scuff-rf/" title="scuff-rf" class="md-nav__link">
      scuff-rf
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-static/scuff-static/" title="scuff-static" class="md-nav__link">
      scuff-static
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-spectrum/scuff-spectrum/" title="scuff-spectrum" class="md-nav__link">
      scuff-spectrum
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-analyze/scuff-analyze/" title="scuff-analyze" class="md-nav__link">
      scuff-analyze
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-integrate/scuff-integrate/" title="scuff-integrate" class="md-nav__link">
      scuff-integrate
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      High-level interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        High-level interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../HighLevelInterface/HighLevelInterface/" title="High-Level Interface" class="md-nav__link">
      High-Level Interface
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Low-level API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Low-level API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/libscuff/" title="libscuff" class="md-nav__link">
      libscuff
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/MainFlow/" title="MainFlow API" class="md-nav__link">
      MainFlow API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../API/UtilityAPI/" title="Utility API" class="md-nav__link">
      Utility API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" checked>
    
    <label class="md-nav__link" for="nav-8">
      For developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        For developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Implementation/" title="Implementation" class="md-nav__link">
      Implementation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DataStructures/" title="Data Structures" class="md-nav__link">
      Data Structures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Documentation/" title="Documentation" class="md-nav__link">
      Documentation
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Code for computing singular integrals
      </label>
    
    <a href="./" title="Code for computing singular integrals" class="md-nav__link md-nav__link--active">
      Code for computing singular integrals
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#2-c-calling-convention" title="2. C++ calling convention" class="md-nav__link">
    2. C++ calling convention
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thread-safety" title="Thread Safety" class="md-nav__link">
    Thread Safety
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fields-in-taylorduffyargstruct" title="Fields in TaylorDuffyArgStruct" class="md-nav__link">
    Fields in TaylorDuffyArgStruct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values-of-the-pindex-field" title="Values of the PIndex field" class="md-nav__link">
    Values of the PIndex field
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values-of-the-kindex-field" title="Values of the KIndex field" class="md-nav__link">
    Values of the KIndex field
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-simple-demonstration-program" title="3. Simple demonstration program" class="md-nav__link">
    3. Simple demonstration program
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#2-c-calling-convention" title="2. C++ calling convention" class="md-nav__link">
    2. C++ calling convention
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thread-safety" title="Thread Safety" class="md-nav__link">
    Thread Safety
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fields-in-taylorduffyargstruct" title="Fields in TaylorDuffyArgStruct" class="md-nav__link">
    Fields in TaylorDuffyArgStruct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values-of-the-pindex-field" title="Values of the PIndex field" class="md-nav__link">
    Values of the PIndex field
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#values-of-the-kindex-field" title="Values of the KIndex field" class="md-nav__link">
    Values of the KIndex field
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-simple-demonstration-program" title="3. Simple demonstration program" class="md-nav__link">
    3. Simple demonstration program
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/homerreid/scuff-em/edit/master/docs/forDevelopers/SingularIntegrals.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1>Computation of Singular Integrals in <span class=SC>scuff-em</span></h1>

<p>A key feature of <span class=SC>scuff-em</span> is an accurate and 
efficient code for computing singular four-dimensional integrals over pairs 
of triangles.
The algorithm that <span class=SC>scuff-em</span>
uses for this purpose---which I call the "generalized Taylor-Duffy method"
in honor of the progenitors of some earlier methods that inspired it---is
discussed in detail in
this paper:</p>
<ul>
<li>
<p>``Generalized Taylor–Duffy Method for Efficient Evaluation of 
    Galerkin Integrals in Boundary-Element Method Computations'',
    <em>IEEE Transactions on Antennas and Propagation</em>
    <strong>63</strong> 195 (2015). </p>
<p>DOI: <a href="http://dx.doi.org/10.1109/TAP.2014.2367492">10.1109/TAP.2014.2367492</a></p>
<p>ArXiV: <a href="http://arxiv.org/abs/1312.1703">http://arxiv.org/abs/1312.1703</a>.</p>
</li>
</ul>
<p>The code that evaluates singular integrals is packaged
with the <span class=SC>scuff-em</span> distribution;
it is contained in a single <code class="codehilite">C++</code> file named
<code class="codehilite">TaylorDuffy.cc</code> (around 1,500 lines).
This code calls the <code class="codehilite">pcubature</code> code from 
<a href="http://ab-initio.mit.edu/wiki/index.php/Cubature">Steven G. Johnson's numerical cubature package.</a></p>
<p>Also, here are the <a class="wikilink" href="../../mathematica/">mathematica</a> codes mentioned in the paper above:</p>
<ul>
<li><a href="../SingularIntegrals/CommonPanel.math"><code class="codehilite">CommonPanel.math</code></a></li>
<li><a href="../SingularIntegrals/CommonEdge.math"><code class="codehilite">CommonEdge.math</code></a></li>
<li><a href="../SingularIntegrals/CommonVertex.math"><code class="codehilite">CommonVertex.math</code></a></li>
</ul>
<p>This page is intended for developers who would like 
to use the <a class="wikilink" href="../../scuff-em/">scuff-em</a> implementation of the generalized Taylor-Duffy
method in their own codes.</p>
<div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#1-what-the-code-actually-computes">1. What the code actually computes</a></li>
<li><a href="#2-c-calling-convention">2. C++ calling convention</a><ul>
<li><a href="#thread-safety">Thread Safety</a></li>
<li><a href="#fields-in-taylorduffyargstruct">Fields in TaylorDuffyArgStruct</a></li>
<li><a href="#values-of-the-pindex-field">Values of the PIndex field</a></li>
<li><a href="#values-of-the-kindex-field">Values of the KIndex field</a></li>
</ul>
</li>
<li><a href="#3-simple-demonstration-program">3. Simple demonstration program</a></li>
</ul>
</div>
<h2 id="1-what-the-code-actually-computes">1. What the code actually computes</h2>
<p>The code provides a <code class="codehilite">C++</code> function named <code class="codehilite">TaylorDuffy</code>
which computes the following four-dimensional integral over a triangle-product
domain:
<script type="math/tex; mode=display"> \mathcal{I}=
   \frac{1}{4AA^\prime}
   \int_{\mathcal T} \, d\mathbf x \, 
   \int_{\mathcal T^\prime} \, d\mathbf x^\prime \,
   P\big(\mathbf x, \mathbf x^\prime\big) K\big(|\mathbf x-\mathbf x^\prime|\big)
   \qquad (1)
</script>
</p>
<p>In this expression,</p>
<ul>
<li>
<script type="math/tex">\mathcal T</script> and <script type="math/tex">\mathcal T^\prime</script> are 
  triangles with at least one common vertex.
  (You supply to <code class="codehilite">TaylorDuffy</code> the cartesian coordinates
  of the triangle vertices.)</li>
</ul>
<p>&nbsp;</p>
<ul>
<li><em>P</em> is a polynomial function of 6 variables (the Cartesian
  components of <strong>x,x'</strong>). Although the underlying algorithm works 
  for arbitrary polynomials <em>P</em>, in the implementation of 
  <code class="codehilite">TaylorDuffy</code> provided below you will select one of 
  a predetermined set of possible polynomials (see below).
  Modifying the code to support other polynomials would be 
  a relatively straightforward, if tedious, task.</li>
</ul>
<p>&nbsp;</p>
<ul>
<li><em>K</em> is a <em>kernel</em> function of a single scalar variable
  <em>r.</em> Although the algorithm works for a fairly wide family of 
   kernel functions, in the implementation of <code class="codehilite">TaylorDuffy</code>
   provided below you will select one of a predetermined set of 
   possible kernels (see below). Again, it should be relatively 
   straightforward to modify the code to support other kernels.</li>
</ul>
<p>Actually, it is more accurate to say that <code class="codehilite">TaylorDuffy</code> 
   computes <em>multiple</em> simultaneous integrals of the form (1);
   in a single call to <code class="codehilite">TaylorDuffy</code> you can specify, for 
   the same triangle pair <em>T,T'</em>, more than one 
   (polynomial, kernel) pair, i.e. 
   <i>{P<sub>n</sub>, K<sub>n</sub>}</i> 
   for <i>n=1,2,...,N</i>, and 
   <code class="codehilite">TaylorDuffy</code> will compute all <i>N</i> integrals at once.
   This is faster than making <i>N</i> separate calls due to the 
   reuse of computational overhead.</p>
<h2 id="2-c-calling-convention">2. C++ calling convention</h2>
<p>The <code class="codehilite">TaylorDuffy</code> routine has many input
arguments (many of which may be set to default values)
and multiple output values. For this reason, instead
of the typical calling convention in which you specify
multiple input arguments to a <code class="codehilite">C++</code> function
and get back a single output value,
<code class="codehilite">TaylorDuffy</code> accepts as its argument a
(pointer to a) single big argument <i>structure</i>.</p>
<p>Thus, within a <code class="codehilite">C/C++</code> program, 
to evaluate one or more integrals of the form (1) for a given
pair of triangles you will </p>
<ol>
<li>
<p>instantiate and initialize a data structure of type <code class="codehilite">TaylorDuffyArgStruct</code>, which stores all input and output arguments, and then </p>
</li>
<li>
<p>simply call <code class="codehilite">TaylorDuffy()</code> with a pointer to your argument structure as the only parameter. On return, the results (the values of the integral) will be stored in the argument structure.</p>
</li>
</ol>
<p>The process looks like this: </p>
<div class="codehilite"><pre><span></span> <span class="c1">// instantiate and initialize argument structure </span>
 <span class="n">TaylorDuffyArgStruct</span> <span class="n">MyTDArgs</span><span class="p">,</span> <span class="o">*</span><span class="n">TDArgs</span><span class="o">=&amp;</span><span class="n">MyTDArgs</span><span class="p">;</span>
 <span class="n">InitTaylorDuffyArgs</span><span class="p">(</span><span class="n">TDArgs</span><span class="p">);</span> <span class="c1">// always call this!</span>

 <span class="c1">// fill in necessary fields </span>
 <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">WhichCase</span> <span class="o">=</span> <span class="n">TD_COMMONVERTEX</span>
 <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">NumPKs</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 
 <span class="p">...</span>

 <span class="c1">// evaluate the integral</span>
 <span class="n">TaylorDuffy</span><span class="p">(</span><span class="n">TDArgs</span><span class="p">);</span>

 <span class="c1">// results are now available inside TDArgs</span>
 <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Result: %e </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">real</span><span class="p">(</span><span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">Result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">);</span>
</pre></div>

<h3 id="thread-safety">Thread Safety</h3>
<p><code class="codehilite">TaylorDuffy()</code> is thread-safe; you may call it 
from multiple simultaneously-executing threads without fear
of crosstalk or race conditions. (Indeed, 
<span class=SC>scuff-em</span> does just this if compiled
with support for <span class=SC>openmp</span>
or <span class=SC>pthreads</span>.)</p>
<h3 id="fields-in-taylorduffyargstruct">Fields in <code class="codehilite">TaylorDuffyArgStruct</code></h3>
<p>The table below details all fields in the argument structure
passed to <code class="codehilite">TaylorDuffy.</code></p>
<p>In general, you should always call <code class="codehilite">InitTaylorDuffyArgs</code>
first to set all optional fields to default values, then fill in 
your desired values for mandatory fields (and overwrite the default
values for any optional fields you wish to tweak).</p>
<table border="1" cellpadding="5" cellspacing="5">

    <!----%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%---->
    <tr>
      <th> Field </th>
      <th> Description </th>
    </tr>

    <!----%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%---->
    <tr> 
       <th colspan=2 height="100"> 
           <i>Mandatory input fields describing the triangles</i>
       </th> 
    </tr>

    <!---------------------------------------------------------->
    <tr>
      <td> <code>int WhichCase;</code> </td>
      <td> Counts the number of common vertices between the 
           two triangles. You should set this to 1, 2, or 3 
           for the common-vertex, common-edge, or common-triangle
           cases. (The file <code>TaylorDuffy.h</code> defines
           the constants 
           <code>TD_COMMONVERTEX=1</code>,
           <code>TD_COMMONEDGE=2</code>,
           <code>TD_COMMONTRIANGLE=3</code>).
      </td>
    </tr>

    <!---------------------------------------------------------->
    <tr>
      <td> <table>
            <tr><td><code>double *V1, *V2, *V3;</code></td></tr>
            <tr><td><code>double *V2P, *V3P;</code></td></tr>
           </table>
      </td>
      <td> Pointers to caller-allocated arrays of length 3 
           containing the <i>x,y,z</i> coordinates of the 
           triangle vertices.

           <p>
           <code>V1, V2, V3</code> are the vertices of triangle 
           <i>T</i>. For example, <code>V2[0,1,2]</code>
           are the <code>x,y,z</code> coordinates of the 
           second vertex.

           <p>
           <code>V2P, V3P</code> are the vertices of triangle
           <i>T'</i> that are <i>not</i> shared with triangle 
           <i>T</i>. It is not always necessary to initialize 
           these fields. In particular,

           <p>
            <ul>
            <li> In the common-triangle case (<code>WhichCase=3</code>),
                 neither <code>V2P</code> nor <code>V3P</code>
                 is referenced.
            <li> In the common-edge case (<code>WhichCase=2</code>),
                 only <code>V3P</code> is referenced; <code>V2P</code>
                 is ignored.
            <li> In the common-vertex case (<code>WhichCase=1</code>),
                 both <code>V2P</code> and <code>V3P</code>
                 are referenced.
            </ul>

      </td>
    </tr>

    <!----%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%---->
    <tr> 
       <th colspan=2 height="100"> 
           <i>Mandatory input fields describing the <b>P</b> 
              and <b>K</b> functions</i>
       </th>
    </tr>

    <!---------------------------------------------------------->
    <tr>
      <td> <table>
            <tr><td><code>int NumPKs;</code></td></tr>
            <tr><td><code>int *PIndex;</code></td></tr>
            <tr><td><code>int *KIndex;</code></td></tr>
            <tr><td><code>int *KParam;</code></td></tr>
           </table>
      </td>
      <td> 
           <p>
           <code>NumPKs</code> specifies the number of 
           integrals of the form (1) you wish to compute 
           (that is, the number of pairings of a polynomial
           <i>P</i> with a kernel <i>K</i>) for the given
           pair of triangles.
           If you only need to compute a single integral,
           set <code>NumPKs=1.</code>

           <p>
           <code>PIndex</code> and <code>KIndex</code> 
           are pointers to caller-allocated arrays
           of length <code>NumPKs</code>. The <code>n</code>th
           entries in these arrays are the indices 
           (in the tables below) of the 
           <code>n</code>th <i>P</i> and <i>K</i>
           functions.

           <p>
           <code>KParam</code> is a pointer to a 
           caller-allocated array of length
           <code>NumPKs</code> containing values of 
           certain parameters that enter the kernel
           functions. The entries of this array are 
           interpreted in different ways depending on 
           the corresponding entries in the 
           <code>KIndex</code> array:

           <ul>
            <li> If <code>KIndex[n]==TD_RP</code> 
                 (the <i>r<sup>p</sup></i> kernel),
                 then <code>KParam[n]</code> is
                 interpreted as the parameter <i>p</i>,
                 i.e. the integer power to which <i>r</i>
                 is raised. (The <code>cdouble-</code>valued
                 quantity
                 <code>KParam[n]</code> is converted to
                 <code>int</code> inside <code>TaylorDuffy.</code>)
            <li> 
                 For all other kernels,
                 <code>KParam[n]</code> is interpreted as 
                 the parameter <i>k</i>, i.e. the 
                 Helmholtz wavenumber. This quantity can
                 be purely real, purely imaginary, or complex.
           </ul>
      </td> 
    </tr>

    <!----%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%---->
    <tr> 
       <th colspan=2 height="100"> 
           <i>Input fields that are required for certain 
              <b>P</b> functions</i>
       </th>
    </tr>

    <!---------------------------------------------------------->
    <tr>
      <td> <code>double *Q, *QP;</code>
      </td>
      <td> Pointers to caller-allocated arrays of length 3 
           containing the <i>x,y,z</i> coordinates of the 
           RWG source/sink vertices <b>Q,Q'</b>. These are 
           only referenced if any entry in the <code>PIndex</code>
           array corresponds to one of the polynomials in the 
           table below whose definition involves <b>Q,Q'.</b>
      </td>
    </tr>

    <!---------------------------------------------------------->
    <tr>
      <td> <code>double *nHat;</code>
      </td>
      <td> Pointers to caller-allocated arrays of length 3 
           containing the <i>x,y,z</i> components of the 
           unit normal vector <b>n</b>. This is only referenced
           if any entry in the <code>PIndex</code> array 
           corresponds to one of the polynomials in the 
           table below whose definition involves <b>n.</b>
      </td>
    </tr>

    <!----%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%---->
    <tr> 
       <th colspan=2 height="100"> 
           <i>Optional input fields controlling integration behavior 
           </i>
       </th>
    </tr>

    <!---------------------------------------------------------->
    <tr>
      <td> <code>double AbsTol, RelTol;</code>
      </td>
      <td> The absolute and relative error tolerances to which
           the adaptive integrator will attempt to compute 
           the integral. (The defaults are <code>AbsTol=0.0</code>
           and <code>RelTol=1.0e-10</code>.) 
      </td>
    </tr>

    <!---------------------------------------------------------->
    <tr>
      <td> <code>int MaxEval;</code>
      </td>
      <td> An upper bound on the number of function samples
           the adaptive integrator may compute. (The default 
           is <code>MaxEval=1000.</code>) Reducing this 
           number will cause the code to run more quickly,
           possibly at the expense of lower accuracy.
      </td>
    </tr>

    <!----%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%---->
    <tr> 
       <th colspan=2 height="100"> 
           <i>Output fields 
           </i>
       </th>
    </tr>

    <!---------------------------------------------------------->
    <tr>
      <td> <code>cdouble *Result, *Error;</code>
      </td>
      <td> Pointers to caller-allocated output buffers 
           with enough space to store <code>NumPKs</code> 
           values of type <code>cdouble</code>. On return,
           <code>Result[n]</code> is the value of the 
           integral for the <code>n</code>th <i>P,K</i> pairing,
           and <code>Error[n]</code> is an estimate of 
           the error incurred by the numerical quadrature.
      </td>
    </tr>

    <!---------------------------------------------------------->
    <tr>
      <td> <code>int nCalls;</code> 
      </td>
      <td> The number of function evaluations used to evaluate
           the numerical cubature.
           This number will not exceed <code>MaxEval.</code>
      </td>
    </tr>

</table>

<h3 id="values-of-the-pindex-field">Values of the <code class="codehilite">PIndex</code> field</h3>
<p>The implementation of <code class="codehilite">TaylorDuffy</code> provided here
contains support for the following choices of the <i>P</i>
polynomial in equation (1). (The values of the <code class="codehilite">PIndex</code>
field here are constants defined in <code class="codehilite">TaylorDuffy.h</code>.)</p>
<p><img alt="P index table" src="../SingularIntegrals/PIndexTable.png" /></p>
<p>In this table, the quantities <b>Q, Q', n</b> are vector-valued
parameters that you specify by setting fields in the argument
structure for the <code class="codehilite">TaylorDuffy</code> routine (see above).
Also, in the final three table entries, the tilde symbol above
a vector-valued quantity indicates the result of crossing that
quantity with the normal vector you specify via the <code class="codehilite">nHat</code> 
field in the argument structure (see above):</p>
<p>
<script type="math/tex; mode=display">
\widetilde{\mathbf x} \equiv \mathbf{\hat n} \times \mathbf x, \qquad 
\widetide{\mathbf Q} \equiv \mathbf{\hat n} \times \mathbf Q
</script>
</p>
<p>For RWG basis-function enthusiasts, note that the last 5 entries 
in the table are appropriate for computing matrix elements of the 
EFIE and MFIE operators between RWG basis functions, but observe
carefully that the prefactor <script type="math/tex">\frac{1}{4AA'}</script> in the definition (1)
is only <i>part</i>
of the full prefactor that arises for RWG basis functions; there 
is also a factor <i>ll'</i> (product of edge lengths) 
which is missing from these calculations, and you must put that 
in yourself, by hand.</p>
<h3 id="values-of-the-kindex-field">Values of the <code class="codehilite">KIndex</code> field</h3>
<p>The implementation of <code class="codehilite">TaylorDuffy</code> provided here
contains support for the following choices of the <i>K</i>
kernel in equation (1). (The values of the <code class="codehilite">KIndex</code>
field here are constants defined in <code class="codehilite">TaylorDuffy.h</code>.)</p>
<p><img alt="K index table" src="../SingularIntegrals/KIndexTable.png" /></p>
<p>In this table, the values of the parameters <i>p</i> and 
<i>k</i> are what you put into the <code class="codehilite">KParam</code>
array in the <code class="codehilite">TaylorDuffyArgStruct</code>. </p>
<h2 id="3-simple-demonstration-program">3. Simple demonstration program</h2>
<p>Here is a little test program that you can download and compile
against the
<a href="../../API/libscuff/"><span class=SC>scuff-em</span> core library</a>
to test the code:</p>
<ul>
<li><a href="../SingularIntegrals/TestTaylorDuffy.cc">TestTaylorDuffy.cc</a></li>
</ul>
<p>Sample output:
<div class="codehilite"><pre><span></span>% TestTaylorDuffy 
Integrand sampled at <span class="m">33</span> points.
Integral <span class="m">1</span>: +3.56771698e-01  <span class="o">(</span>estimated error: <span class="m">6</span>.0e-12<span class="o">)</span>
Integral <span class="m">2</span>: +1.57003236e-03  <span class="o">(</span>estimated error: <span class="m">1</span>.2e-11<span class="o">)</span>
Computation time: <span class="m">1</span>.209307e+02 microseconds
</pre></div></p>
<p>Here is a listing of the program:
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;TaylorDuffy.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">scuff</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="cm">/* panel vertices */</span>
  <span class="kt">int</span> <span class="n">WhichCase</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// 2 common vertices</span>
  <span class="kt">double</span> <span class="n">V1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="o">=</span>  <span class="p">{</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span> <span class="p">};</span>
  <span class="kt">double</span> <span class="n">V2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="o">=</span>  <span class="p">{</span> <span class="mf">0.1</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span> <span class="p">};</span>
  <span class="kt">double</span> <span class="n">V3</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="o">=</span>  <span class="p">{</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>  <span class="mf">0.0</span> <span class="p">};</span>
  <span class="kt">double</span> <span class="n">V3P</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span>  <span class="p">{</span> <span class="mf">0.07</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.03</span> <span class="p">};</span>

  <span class="kt">double</span> <span class="o">*</span><span class="n">Q</span>     <span class="o">=</span> <span class="n">V3</span><span class="p">;</span>  <span class="c1">// source/sink vertex, triangle 1</span>
  <span class="kt">double</span> <span class="o">*</span><span class="n">QP</span>    <span class="o">=</span> <span class="n">V3P</span><span class="p">;</span> <span class="c1">// source/sink vertex, triangle 2</span>

  <span class="cm">/* specification of which integrals we want */</span>
  <span class="kt">int</span> <span class="n">NumPKs</span>        <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">PIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>     <span class="o">=</span> <span class="p">{</span><span class="n">TD_UNITY</span><span class="p">,</span> <span class="n">TD_PMCHWC</span><span class="p">};</span>
  <span class="kt">int</span> <span class="n">KIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>     <span class="o">=</span> <span class="p">{</span><span class="n">TD_RP</span><span class="p">,</span>    <span class="n">TD_RP</span><span class="p">};</span>
  <span class="n">cdouble</span> <span class="n">KParam</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>    <span class="o">-</span><span class="mf">3.0</span><span class="p">};</span>

  <span class="cm">/* output buffers */</span>
  <span class="n">cdouble</span> <span class="n">Result</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Error</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

  <span class="cm">/* fill in argument structure with problem description */</span>
  <span class="n">TaylorDuffyArgStruct</span> <span class="n">MyTDArgs</span><span class="p">,</span> <span class="o">*</span><span class="n">TDArgs</span><span class="o">=&amp;</span><span class="n">MyTDArgs</span><span class="p">;</span>
  <span class="n">InitTaylorDuffyArgs</span><span class="p">(</span><span class="n">TDArgs</span><span class="p">);</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">WhichCase</span> <span class="o">=</span> <span class="n">WhichCase</span><span class="p">;</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">V1</span>        <span class="o">=</span> <span class="n">V1</span><span class="p">;</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">V2</span>        <span class="o">=</span> <span class="n">V2</span><span class="p">;</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">V3</span>        <span class="o">=</span> <span class="n">V3</span><span class="p">;</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">V3P</span>       <span class="o">=</span> <span class="n">V3P</span><span class="p">;</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">Q</span>         <span class="o">=</span> <span class="n">Q</span><span class="p">;</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">QP</span>        <span class="o">=</span> <span class="n">QP</span><span class="p">;</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">NumPKs</span>    <span class="o">=</span> <span class="n">NumPKs</span><span class="p">;</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">PIndex</span>    <span class="o">=</span> <span class="n">PIndex</span><span class="p">;</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">KIndex</span>    <span class="o">=</span> <span class="n">KIndex</span><span class="p">;</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">KParam</span>    <span class="o">=</span> <span class="n">KParam</span><span class="p">;</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">Result</span>    <span class="o">=</span> <span class="n">Result</span><span class="p">;</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">Error</span>     <span class="o">=</span> <span class="n">Error</span><span class="p">;</span>  

  <span class="cm">/* specify desired error tolerance */</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">RelTol</span>    <span class="o">=</span> <span class="mf">1.0e-10</span><span class="p">;</span>   <span class="c1">// request 10-digit accuracy</span>
  <span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">MaxEval</span>   <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>        <span class="c1">// upper limit on integrand samples</span>

  <span class="cm">/* calculate the integral */</span>
  <span class="n">TaylorDuffy</span><span class="p">(</span> <span class="n">TDArgs</span> <span class="p">);</span>

  <span class="cm">/* print the results */</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Integrand sampled at %i points.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">TDArgs</span><span class="o">-&gt;</span><span class="n">nCalls</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Integral 1: {%+.8e, %+.8e} (estimated error {%.1e.,%.1e}) </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
          <span class="n">real</span><span class="p">(</span><span class="n">Result</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">imag</span><span class="p">(</span><span class="n">Result</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">real</span><span class="p">(</span><span class="n">Error</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">imag</span><span class="p">(</span><span class="n">Error</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Integral 2: {%+.8e, %+.8e} (estimated error {%.1e.,%.1e}) </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
          <span class="n">real</span><span class="p">(</span><span class="n">Result</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">imag</span><span class="p">(</span><span class="n">Result</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">real</span><span class="p">(</span><span class="n">Error</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">imag</span><span class="p">(</span><span class="n">Error</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>

  <span class="cm">/* uncomment the following line to report computation time */</span>
<span class="c1">//#define MEASURE_RUNTIME</span>
<span class="cp">#ifdef MEASURE_RUNTIME</span>
<span class="cp">#define REPETITIONS 100</span>
  <span class="n">Tic</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">n</span><span class="o">&lt;</span><span class="n">REPETITIONS</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
   <span class="n">TaylorDuffy</span><span class="p">(</span> <span class="n">TDArgs</span> <span class="p">);</span>
  <span class="kt">double</span> <span class="n">TimeElapsed</span> <span class="o">=</span> <span class="n">Toc</span><span class="p">()</span> <span class="o">/</span> <span class="n">REPETITIONS</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Computation time: %e microseconds</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="mf">1.0e6</span><span class="o">*</span><span class="n">TimeElapsed</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="p">}</span>
</pre></div></p>
<p>And here is a simple <a href="../SingularIntegrals/Makefile"><code class="codehilite">Makefile</code></a>
that compiles and links against the <a class="wikilink" href="../../scuff-em/">scuff-em</a> installation 
on your system (you'll need to modify a few lines at the top 
of this file appropriately for your system):</p>
<div class="codehilite"><pre><span></span><span class="c"># top of SCUFF-EM src tree</span>
<span class="nv">SCUFF_SRC</span><span class="o">=</span><span class="k">$(</span>HOME<span class="k">)</span>/work/scuff-em

<span class="c"># SCUFF-EM installation prefix (set with --prefix when running configure)</span>
<span class="nv">SCUFF_INSTALL</span><span class="o">=</span><span class="k">$(</span>HOME<span class="k">)</span>/work/scuff-em-installation

<span class="c"># HDF5 / Lapack libraries</span>
<span class="nv">HDF5_LIBS</span><span class="o">=</span>-lhdf5_hl -lhdf5
<span class="nv">MATH_LIBS</span><span class="o">=</span>-lopenblas -lgomp -lgfortran -lpthread

<span class="c">##################################################</span>
<span class="c"># shouldn&#39;t need to modify the rest</span>
<span class="c">##################################################</span>
<span class="nv">CPPFLAGS</span><span class="o">+=</span>-I<span class="k">$(</span>SCUFF_SRC<span class="k">)</span>/libs/libscuff 
<span class="nv">CPPFLAGS</span><span class="o">+=</span>-I<span class="k">$(</span>SCUFF_INSTALL<span class="k">)</span>/include/scuff-em

<span class="nv">LIBDIR</span><span class="o">=</span><span class="k">$(</span>SCUFF_INSTALL<span class="k">)</span>/lib
<span class="nv">LDFLAGS</span><span class="o">+=</span>-L<span class="k">$(</span>LIBDIR<span class="k">)</span> -Wl,-rpath,<span class="k">$(</span>LIBDIR<span class="k">)</span>

<span class="nv">SCUFF_LIBS</span><span class="o">=</span>-lscuff
<span class="nv">LIBS</span><span class="o">=</span><span class="k">$(</span>SCUFF_LIBS<span class="k">)</span> <span class="k">$(</span>HDF5_LIBS<span class="k">)</span> <span class="k">$(</span>MATH_LIBS<span class="k">)</span>

<span class="nf">TestTaylorDuffy</span><span class="o">:</span>        <span class="n">TestTaylorDuffy</span>.<span class="n">o</span>
                <span class="k">$(</span>CXX<span class="k">)</span> <span class="k">$(</span>LDFLAGS<span class="k">)</span> -o <span class="nv">$@</span> $^ <span class="k">$(</span>LIBS<span class="k">)</span>
</pre></div>
                
                  
                
              
              
                



  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "http://homerreid.github.io/scuff-em-documentation/forDevelopers/SingularIntegrals/";
      this.page.identifier =
        "/forDevelopers/SingularIntegrals/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//homerreid-github-io-scuff-em-documentation.disqus.com.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Documentation/" title="Documentation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Documentation
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b438e6c5.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:"../.."}})</script>
      
        <script src="../../javascripts/MathJax.js?config=TeX-AMS_HTML"></script>
      
        <script src="../../javascripts/mathjaxhelper.js"></script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-119340518-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>