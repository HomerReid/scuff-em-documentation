



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="http://homerreid.github.io/scuff-em-documentation/API/MainFlow/">
      
      
        <meta name="author" content="Homer Reid">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.3">
    
    
      
        <title>MainFlow API - SCUFF-EM documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.8d40d89b.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,400,400i,700|">
        <style>body,input{font-family:"Noto Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/scuff-em.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#1-creating-an-rwggeometry" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://homerreid.github.io/scuff-em-documentation" title="SCUFF-EM documentation" class="md-header-nav__button md-logo">
          
            <img src="../../reference/scuffEMLogo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                SCUFF-EM documentation
              </span>
              <span class="md-header-nav__topic">
                MainFlow API
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/homerreid/scuff-em/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      scuff-em
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../examples/" title="Examples" class="md-tabs__link">
          Examples
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../tests/Overview/" title="Test suite" class="md-tabs__link">
          Test suite
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../reference/TopLevel/" title="General reference" class="md-tabs__link">
          General reference
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../applications/GeneralReference/" title="Command-line tools" class="md-tabs__link">
          Command-line tools
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../HighLevelInterface/HighLevelInterface/" title="High-level interface" class="md-tabs__link">
          High-level interface
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../libscuff/" title="Low-level API" class="md-tabs__link md-tabs__link--active">
          Low-level API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../forDevelopers/Implementation/" title="For developers" class="md-tabs__link">
          For developers
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../reference/scuffEMLogo.png" width="48" height="48">
      
    </span>
    SCUFF-EM documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/homerreid/scuff-em/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      scuff-em
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/" title="SCUFF-EM tutorial examples" class="md-nav__link">
      SCUFF-EM tutorial examples
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/MieScattering/MieScattering/" title="Mie scattering" class="md-nav__link">
      Mie scattering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/DielectricShell/DielectricShell/" title="Electrostatics of a spherical dielectric shell" class="md-nav__link">
      Electrostatics of a spherical dielectric shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/ThinFilm/ThinFilm/" title="Spatially-resolved study of plane-wave transmission through an infinite-area thin dielectric film" class="md-nav__link">
      Spatially-resolved study of plane-wave transmission through an infinite-area thin dielectric film
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/DiffractionPatterns/DiffractionPatterns/" title="Imaging diffraction patterns of discs, disc arrays, and hole arrays in metal screens" class="md-nav__link">
      Imaging diffraction patterns of discs, disc arrays, and hole arrays in metal screens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/NanorodResonantModes/NanorodResonantModes/" title="Mode frequencies and field patterns of resonant modes in gold nanorods" class="md-nav__link">
      Mode frequencies and field patterns of resonant modes in gold nanorods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/CubeTorus/" title="Casimir forces in a compact geometry" class="md-nav__link">
      Casimir forces in a compact geometry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/SiliconBeams/SiliconBeams/" title="Casimir forces in a 1D extended geometry" class="md-nav__link">
      Casimir forces in a 1D extended geometry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/SiliconSlabs/SiliconSlabs/" title="Casimir forces in a 2D extended geometry" class="md-nav__link">
      Casimir forces in a 2D extended geometry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/NanostructureCasimirPolder/NanostructureCasimirPolder/" title="Casimir-Polder potentials in dielectric nanostructures" class="md-nav__link">
      Casimir-Polder potentials in dielectric nanostructures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/SiO2Spheres/SiO2Spheres/" title="Thermal radiation, heat transfer, and non-equilibrium Casimir forces between silicon dioxide spheres" class="md-nav__link">
      Thermal radiation, heat transfer, and non-equilibrium Casimir forces between silicon dioxide spheres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/TipSubstrate/TipSubstrate/" title="Spatial distribution of heat flux from a warm tip over a cold substrate" class="md-nav__link">
      Spatial distribution of heat flux from a warm tip over a cold substrate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/HalfSpaceLDOS/HalfSpaceLDOS/" title="LDOS and dyadic Green functions above an infinite aluminum half-space" class="md-nav__link">
      LDOS and dyadic Green functions above an infinite aluminum half-space
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/PlatonicSolids/PlatonicSolids/" title="Electrostatic polarizability of platonic solids" class="md-nav__link">
      Electrostatic polarizability of platonic solids
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/TwoBodyCapacitors/TwoBodyCapacitors/" title="Capacitance of two-body capacitors" class="md-nav__link">
      Capacitance of two-body capacitors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/StriplineCapacitor/StriplineCapacitor/" title="Capacitance of a PCB stripline trace" class="md-nav__link">
      Capacitance of a PCB stripline trace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/ImplicitSubstrate/ImplicitSubstrate/" title="Implicit handling of multilayer dielectric substrates" class="md-nav__link">
      Implicit handling of multilayer dielectric substrates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/pythonCapacitance/pythonCapacitance/" title="Finite-size effects in stripline capacitors" class="md-nav__link">
      Finite-size effects in stripline capacitors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/PaulTrap/PaulTrap/" title="Electrostatic fields of an electrode array" class="md-nav__link">
      Electrostatic fields of an electrode array
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/YagiUdaAntennas/YagiUdaAntennas/" title="Z-parameters and directivity of Yagi-Uda antennas" class="md-nav__link">
      Z-parameters and directivity of Yagi-Uda antennas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/MicrostripDevices/MicrostripDevices/" title="Input impedance, mutual coupling, and radiated fields of microstrip RF devices" class="md-nav__link">
      Input impedance, mutual coupling, and radiated fields of microstrip RF devices
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Test suite
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Test suite
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/Overview/" title="Overview of the test suite" class="md-nav__link">
      Overview of the test suite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/MieScattering/MieScattering/" title="Mie scattering" class="md-nav__link">
      Mie scattering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/FresnelScattering/FresnelScattering/" title="Fresnel scattering" class="md-nav__link">
      Fresnel scattering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/CasimirSpheres/CasimirSpheres/" title="Equilibrium Casimir forces between spheres" class="md-nav__link">
      Equilibrium Casimir forces between spheres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/CasimirPlates/CasimirPlates/" title="Equilibrium Casimir forces between plates" class="md-nav__link">
      Equilibrium Casimir forces between plates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/CPSphere/CPSphere/" title="Equilibrium Casimir-Polder potential near a sphere" class="md-nav__link">
      Equilibrium Casimir-Polder potential near a sphere
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/CPPlate/CPPlate/" title="Equilibrium Casimir-Polder potential near a plate" class="md-nav__link">
      Equilibrium Casimir-Polder potential near a plate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/NEQSpheres/NEQSpheres/" title="Heat transfer and non-equilibrium Casimir forces between spheres" class="md-nav__link">
      Heat transfer and non-equilibrium Casimir forces between spheres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tests/libscuff/libscuff/" title="Low-level tests of the core library" class="md-nav__link">
      Low-level tests of the core library
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      General reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        General reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/TopLevel/" title="Top-level overview" class="md-nav__link">
      Top-level overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Installing/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Geometries/" title="Geometry descriptions" class="md-nav__link">
      Geometry descriptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/EquivalentEdgeSurfacePairs/" title="Equivalent edge/surface pairs" class="md-nav__link">
      Equivalent edge/surface pairs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Materials/" title="Material designations" class="md-nav__link">
      Material designations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Transformations/" title="Geometric transformations" class="md-nav__link">
      Geometric transformations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/IncidentFields/" title="Incident fields" class="md-nav__link">
      Incident fields
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/BrillouinZoneIntegration/" title="Brillouin zone integration" class="md-nav__link">
      Brillouin zone integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/FAQ/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Command-line tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Command-line tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/GeneralReference/" title="General command-line reference" class="md-nav__link">
      General command-line reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-scatter/scuff-scatter/" title="scuff-scatter" class="md-nav__link">
      scuff-scatter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-transmission/scuff-transmission/" title="scuff-transmission" class="md-nav__link">
      scuff-transmission
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-ldos/scuff-ldos/" title="scuff-ldos" class="md-nav__link">
      scuff-ldos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-tmatrix/scuff-tmatrix/" title="scuff-tmatrix" class="md-nav__link">
      scuff-tmatrix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-cas3D/scuff-cas3D/" title="scuff-cas3D" class="md-nav__link">
      scuff-cas3D
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-caspol/scuff-caspol/" title="scuff-caspol" class="md-nav__link">
      scuff-caspol
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-neq/scuff-neq/" title="scuff-neq" class="md-nav__link">
      scuff-neq
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-rf/scuff-rf/" title="scuff-rf" class="md-nav__link">
      scuff-rf
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-static/scuff-static/" title="scuff-static" class="md-nav__link">
      scuff-static
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-spectrum/scuff-spectrum/" title="scuff-spectrum" class="md-nav__link">
      scuff-spectrum
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-analyze/scuff-analyze/" title="scuff-analyze" class="md-nav__link">
      scuff-analyze
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applications/scuff-integrate/scuff-integrate/" title="scuff-integrate" class="md-nav__link">
      scuff-integrate
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      High-level interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        High-level interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../HighLevelInterface/HighLevelInterface/" title="High-Level Interface" class="md-nav__link">
      High-Level Interface
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Low-level API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Low-level API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../libscuff/" title="libscuff" class="md-nav__link">
      libscuff
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
    <a href="./" title="MainFlow API" class="md-nav__link md-nav__link--active">
      MainFlow API
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../UtilityAPI/" title="Utility API" class="md-nav__link">
      Utility API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      For developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        For developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../forDevelopers/Implementation/" title="Implementation" class="md-nav__link">
      Implementation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../forDevelopers/DataStructures/" title="Data Structures" class="md-nav__link">
      Data Structures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../forDevelopers/Documentation/" title="Documentation" class="md-nav__link">
      Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../forDevelopers/SingularIntegrals/" title="Code for computing singular integrals" class="md-nav__link">
      Code for computing singular integrals
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/homerreid/scuff-em/edit/master/docs/API/MainFlow.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="libscuff-api-main-flow-routines"><span class=SC>libscuff</span> API: Main Flow Routines</h1>
<p>This page documents the <em>main flow</em> portion of the 
<span class=SC>libscuff</span> API -- that is, the 
routines that implement the key steps in the procedure for
solving electromagnetic scattering problems.</p>
<p>The surface-integral-equation/boundary-element-method (SIE/BEM)
approach to Maxwell's equations implemented by <span class=SC>scuff-em</span>
is discussed on the <a href="../../forDevelopers/Implementation/">implementation notes page</a>
(and in more detail in the technical documents referenced therein);
the key equation is this linear system of equations:</p>
<p><img alt="SIE/BEM matrix equations" src="../../forDevelopers/MatrixEquation.png" /></p>
<p>in which the RHS vector <script type="math/tex">{\mathbf{e} \choose \mathbf{h}}</script>
describes incident fields impinging on one or more scatterers,
the matrix <script type="math/tex">\mathbf M</script> describes interactions among those scatterers,
and the unknown vector <script type="math/tex">{\mathbf{k} \choose \mathbf{n}}</script>
describes surface currents induced on the scatterers by the 
incident fields. (In what follows, we will refer to the matrix here
as <code class="codehilite">M</code>, to the vector on the left-hand side as <code class="codehilite">KN</code>, and to the 
vector on the right-hand side as <code class="codehilite">RHS</code>).
After assembling and solving this system 
for the surface currents, we can use them to compute various physical
quantities of interest (scattered fields, power/force/torque, etc.).</p>
<p>The steps in the <em>main flow</em> of a 
<span class=SC>libscuff</span> scattering problem 
are the following:</p>
<ul>
<li>
<p>Create an <code class="codehilite">RWGGeometry</code> object from a <a href="../../reference/Geometries/"><code class="codehilite"><span class="na">.scuffgeo</span></code> file</a>.</p>
</li>
<li>
<p>Assemble the BEM matrix <code class="codehilite">M</code> at a given frequency (and Bloch vector for periodic geometries).</p>
</li>
<li>
<p>Assemble the RHS vector <code class="codehilite">RHS</code> for a given incident field.</p>
</li>
<li>
<p>Solve the linear system <code class="codehilite">M*KN=RHS</code> for the surface-current vector <code class="codehilite">KN</code>. </p>
</li>
<li>
<p>Perform various post-processing operations on the <code class="codehilite">KN</code> vector to compute
physical quantities of interest.</p>
</li>
</ul>
<p>The <span class=SC>libscuff</span> API routines for each of 
these steps are discussed below.</p>
<div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#libscuff-api-main-flow-routines"><span class=SC>libscuff</span> API: Main Flow Routines</a></li>
<li><a href="#1-creating-an-rwggeometry">1. Creating an RWGGeometry</a></li>
<li><a href="#2-assembling-the-siebem-matrix">2. Assembling the SIE/BEM matrix</a></li>
<li><a href="#3-assembling-the-rhs-vector">3. Assembling the RHS vector</a></li>
<li><a href="#4-solving-the-bem-system">4. Solving the BEM system</a><ul>
<li><a href="#solving-the-bem-system-in-c-programs">Solving the BEM system in C++ programs</a><ul>
<li><a href="#solving-the-bem-system-in-python-programs">Solving the BEM system in Python programs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#5-postprocessing-to-compute-scattered-fields-and-other-quantities">5. Postprocessing to compute scattered fields and other quantities</a><ul>
<li><a href="#field-components-at-arbitrary-points-in-space">Field components at arbitrary points in space</a><ul>
<li><a href="#selecting-the-incident-scattered-or-total-fields">Selecting the Incident, Scattered, or Total Fields</a><ul>
<li><a href="#field-components-at-a-single-point">Field components at a single point</a></li>
<li><a href="#scattered-field-components-at-multiple-points">Scattered field components at multiple points</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="1-creating-an-rwggeometry">1. Creating an RWGGeometry</h1>
<p>The <code class="codehilite">RWGGeometry</code> class constructor takes a string 
argument that should be the name of a 
<a href="../scuff-EM/reference/scuffEMGeometries.shtml"><code class="codehilite"><span class="na">.scuffgeo</span></code> file.</a></p>
<p>C++:</p>
<div class="codehilite"><pre><span></span> <span class="n">RWGGeometry</span> <span class="o">*</span><span class="n">G</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RWGGeometry</span><span class="p">(</span><span class="s">&quot;MyGeometry.scuffgeo&quot;</span><span class="p">);</span>
</pre></div>

<p>Python:</p>
<div class="codehilite"><pre><span></span> <span class="n">G</span> <span class="o">=</span>  <span class="n">scuff</span><span class="o">.</span><span class="n">RWGGeometry</span><span class="p">(</span><span class="s2">&quot;MyGeometry.scuffgeo&quot;</span><span class="p">);</span>
</pre></div>

<h1 id="2-assembling-the-siebem-matrix">2. Assembling the SIE/BEM matrix</h1>
<p>The BEM matrix is assembled by the <code class="codehilite">AssembleBEMMatrix()</code> class method of <code class="codehilite">RWGGeometry.</code>
The simplest invocation of this function requires only that you specify the angular frequency:</p>
<p>C++: </p>
<div class="codehilite"><pre><span></span> <span class="n">HMatrix</span> <span class="o">*</span><span class="n">M</span> <span class="o">=</span> <span class="n">G</span><span class="o">-&gt;</span><span class="n">AssembleBEMMatrix</span><span class="p">(</span><span class="mf">3.197</span><span class="p">);</span>
</pre></div>

<p>python:</p>
<div class="codehilite"><pre><span></span> <span class="n">M</span> <span class="o">=</span>  <span class="n">G</span><span class="o">.</span><span class="n">AssembleBEMMatrix</span><span class="p">(</span><span class="mf">3.197</span><span class="p">);</span>
</pre></div>

<p>The return value of this function is a pointer to a newly-allocated
instance of <code class="codehilite">HMatrix</code>, a 
<a href="../scuff-EM/libscuff/MatrixVector.shtml">simple matrix class</a> provided
by <span class="SC">libscuff.</span> If you later want to 
recompute the matrix at a different frequency, you can pass 
<code class="codehilite">M</code> back as the second argument of 
<code class="codehilite">AssembleBEMMatrix</code> to avoid reallocating new storage:</p>
<div class="codehilite"><pre><span></span> <span class="c1">// first computation; allocates a new matrix</span>
 <span class="n">HMatrix</span> <span class="o">*</span><span class="n">M</span> <span class="o">=</span> <span class="n">G</span><span class="o">-&gt;</span><span class="n">AssembleBEMMatrix</span><span class="p">(</span><span class="mf">3.197</span><span class="p">);</span>

 <span class="c1">// subsequent computation; reuses the existing matrix</span>
 <span class="n">G</span><span class="o">-&gt;</span><span class="n">AssembleBEMMatrix</span><span class="p">(</span><span class="mf">5.134</span><span class="p">,</span> <span class="n">M</span><span class="p">);</span>
</pre></div>

<p>The angular-frequency parameter to <code class="codehilite">AssembleBEMMatrix</code> has type <code class="codehilite">cdouble,</code> which is 
<span class=SC>libscuff</span> shorthand for a complex number consisting
of two <code class="codehilite">double</code>-values:</p>
<div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">cdouble</span><span class="p">;</span>
</pre></div>

<div class="codehilite"><pre><span></span> <span class="n">cdouble</span> <span class="nf">Omega</span><span class="p">(</span><span class="mf">2.3</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">);</span>

 <span class="n">HMatrix</span> <span class="o">*</span><span class="n">M</span> <span class="o">=</span> <span class="n">G</span><span class="o">-&gt;</span><span class="n">AssembleBEMMatrix</span><span class="p">(</span><span class="n">Omega</span><span class="p">);</span>
</pre></div>

<h1 id="3-assembling-the-rhs-vector">3. Assembling the RHS vector</h1>
<p>The RHS vector is assembled by the <code class="codehilite">AssembleRHSVector()</code> class method provided by <code class="codehilite">RWGGeometry.</code>
Before you can call this routine, you must define the incident field in your scattering geometry. This is done by instantiating a class derived from the <code class="codehilite">IncField</code> base class defined in <code class="codehilite">libscuff.h</code>.</p>
<p>For most users, this will be a one-liner, because
<span class="SC">libscuff</span> comes with several
built-in classes derived from <code class="codehilite">IncField</code>
that implement commonly-encountered types of incident field, 
including plane waves, Gaussian laser beams, and the fields of
pointlike dipole radiators. For an instance, you can define a
plane wave traveling in the positive <em>z</em> direction with
<strong>E-</strong> field polarized in the <em>x</em> direction like this:</p>
<div class="codehilite"><pre><span></span> <span class="kt">double</span> <span class="n">pwDir</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="o">=</span> <span class="p">{</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">};</span>
 <span class="n">cdouble</span> <span class="n">pwPol</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">};</span>
 <span class="n">pw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PlaneWave</span><span class="p">(</span><span class="n">pwPol</span><span class="p">,</span> <span class="n">pwDir</span><span class="p">);</span>
</pre></div>

<div class="codehilite"><pre><span></span> <span class="n">pw</span> <span class="o">=</span> <span class="n">scuff</span><span class="o">.</span><span class="n">PlaneWave</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

<p>For details on how to create plane waves and other types of
incident fields, as well as information on how to create your 
own derived subclass of <code class="codehilite">IncField</code> to represent an
arbitrary incident field, see the 
<a href="../scuff-em/libscuff/IncField.shtml">IncField documentation.</a></p>
<p>Having defined our incident field, we pass it, and the frequency,
to <code class="codehilite">AssembleRHSVector</code>:</p>
<div class="codehilite"><pre><span></span> <span class="n">pw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PlaneWave</span><span class="p">(</span><span class="n">pwPol</span><span class="p">,</span> <span class="n">pwDir</span><span class="p">);</span>
 <span class="n">HVector</span> <span class="o">*</span><span class="n">RHS</span> <span class="o">=</span> <span class="n">AssembleRHSVector</span><span class="p">(</span><span class="n">Omega</span><span class="p">,</span> <span class="n">pw</span><span class="p">);</span>
</pre></div>

<div class="codehilite"><pre><span></span> <span class="n">pw</span> <span class="o">=</span> <span class="n">scuff</span><span class="o">.</span><span class="n">PlaneWave</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
 <span class="n">RHS</span>  <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">AssembleRHSVector</span><span class="p">(</span><span class="n">Omega</span><span class="p">,</span> <span class="n">pw</span><span class="p">)</span>
</pre></div>

<p>As with <code class="codehilite">AssembleBEMMatrix</code>, these invocations 
of <code class="codehilite">AssembleRHSVector</code> will cause a new <code class="codehilite">HVector</code>
to be allocated. If you later want to reuse the same vector
to store a different right-hand side, you can pass it as the 
third argument:</p>
<div class="codehilite"><pre><span></span> <span class="c1">// first computation; allocates a new vector</span>
 <span class="n">pw1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PlaneWave</span><span class="p">(</span><span class="n">pwPol1</span><span class="p">,</span> <span class="n">pwDir1</span><span class="p">);</span>
 <span class="n">HVector</span> <span class="o">*</span><span class="n">RHS</span> <span class="o">=</span> <span class="n">G</span><span class="o">-&gt;</span><span class="n">AssembleRHSVector</span><span class="p">(</span><span class="n">Omega</span><span class="p">,</span> <span class="n">pw1</span><span class="p">);</span>

 <span class="c1">// subsequent computation; reuses the existing vector</span>
 <span class="n">pw2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PlaneWave</span><span class="p">(</span><span class="n">pwPol2</span><span class="p">,</span> <span class="n">pwDir2</span><span class="p">);</span>
 <span class="n">G</span><span class="o">-&gt;</span><span class="n">AssembleRHSVector</span><span class="p">(</span><span class="n">Omega</span><span class="p">,</span> <span class="n">pw</span><span class="p">,</span> <span class="n">RHS</span><span class="p">);</span>
</pre></div>

<h1 id="4-solving-the-bem-system">4. Solving the BEM system</h1>
<p>Having assembled the BEM matrix and the RHS vector, the next step
is to do some numerical linear algebra to solve the BEM system for 
the vector of surface-current expansion coefficients. </p>
<h2 id="solving-the-bem-system-in-c-programs">Solving the BEM system in C++ programs</h2>
<p>From a C++ program, the easiest way to do this is to use the 
simple interface to
<a href="http://www.netlib.org/lapack">LAPACK</a> provided by
the 
<a href="scuff-em/libscuff/MatrixVector.shtml">
<span class=SC">libscuff</span> matrix/vector support layer.</a>
Specifically, after assembling the BEM matrix <code class="codehilite">M</code> you 
say <code class="codehilite">M-&gt;LUFactorize()</code> to replace <code class="codehilite">M</code> with its
LU-factorization; then, after assembling the RHS vector <code class="codehilite">RHS</code>
you say <code class="codehilite">M-&gt;LUSolve(RHS)</code> to replace <code class="codehilite">RHS</code>
with the solution of the system <code class="codehilite">M*KN=RHS.</code></p>
<p>Note that you only have to call <code class="codehilite">LUFactorize()</code> 
<em>once</em> on a given BEM matrix, after which you can make any
number of calls to <code class="codehilite">LUSolve()</code> to solve the linear system
for any number of right-hand side vectors. If you subsequently 
reassemble the BEM matrix (say, at a different frequency), you 
must call <code class="codehilite">LUFactorize()</code> again before starting to 
do <code class="codehilite">LUSolves.</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">RWGGeometry</span> <span class="o">*</span><span class="n">G</span><span class="o">=</span><span class="k">new</span> <span class="n">RWGGeometry</span><span class="p">(</span><span class="s">&quot;MyGeometry.scuffgeo&quot;</span><span class="p">);</span>

<span class="n">HMatrix</span> <span class="o">*</span><span class="n">M</span><span class="o">=</span><span class="n">G</span><span class="o">-&gt;</span><span class="n">AllocateBEMMatrix</span><span class="p">();</span>

<span class="n">HMatrix</span> <span class="o">*</span><span class="n">KN</span><span class="o">=</span><span class="n">G</span><span class="o">-&gt;</span><span class="n">AllocateRHSVector</span><span class="p">();</span>

<span class="k">for</span><span class="p">(</span> <span class="n">nf</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">nf</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">NumFreqs</span><span class="p">;</span> <span class="n">nf</span><span class="o">++</span> <span class="p">)</span> 
 <span class="p">{</span> 
   <span class="n">G</span><span class="o">-&gt;</span><span class="n">AssembleBEMMatrix</span><span class="p">(</span> <span class="n">OmegaValues</span><span class="p">[</span><span class="n">nf</span><span class="p">],</span> <span class="n">M</span> <span class="p">);</span>
   <span class="n">M</span><span class="o">-&gt;</span><span class="n">LUFactorize</span><span class="p">();</span>

   <span class="k">for</span><span class="p">(</span> <span class="n">ni</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">ni</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">NumIncidentFields</span><span class="p">;</span> <span class="n">ni</span><span class="o">++</span> <span class="p">)</span>
    <span class="p">{</span> 
      <span class="n">G</span><span class="o">-&gt;</span><span class="n">AssembleRHSVector</span><span class="p">(</span> <span class="n">OmegaValues</span><span class="p">[</span><span class="n">nf</span><span class="p">],</span> <span class="n">IncFields</span><span class="p">[</span><span class="n">ni</span><span class="p">],</span> <span class="n">KN</span> <span class="p">);</span>
      <span class="n">M</span><span class="o">-&gt;</span><span class="n">LUSolve</span><span class="p">(</span><span class="n">KN</span><span class="p">);</span>

      <span class="c1">// now call GetFields() and/or do other things with the solution vector KN</span>

    <span class="p">};</span>
 <span class="p">};</span>
</pre></div>

<h3 id="solving-the-bem-system-in-python-programs">Solving the BEM system in Python programs</h3>
<p>Probably the easiest thing to do here is to use
<code class="codehilite">numpy.linalg.solve</code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span><span class="p">;</span>
<span class="n">KN</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">RHS</span><span class="p">)</span>
</pre></div>

<p>Alternatively, you can access the LAPACK wrappers provided by 
<span class="SC">libscuff:</span></p>
<div class="codehilite"><pre><span></span> <span class="n">M2</span> <span class="o">=</span> <span class="n">scuff</span><span class="o">.</span><span class="n">HMatrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
 <span class="n">M2</span><span class="o">.</span><span class="n">LUFactorize</span><span class="p">()</span>
 <span class="n">KN</span> <span class="o">=</span> <span class="n">RHS</span>
 <span class="n">M2</span><span class="o">.</span><span class="n">LUSolve</span><span class="p">(</span><span class="n">LHS2</span><span class="p">)</span>
</pre></div>

<h1 id="5-postprocessing-to-compute-scattered-fields-and-other-quantities">5. Postprocessing to compute scattered fields and other quantities</h1>
<p>The final step in the main flow is to use the solution to the 
BEM system to compute various physical quantities of interest.</p>
<h2 id="field-components-at-arbitrary-points-in-space">Field components at arbitrary points in space</h2>
<p>Field components are computed by the <code class="codehilite">GetFields</code> class method of <code class="codehilite">RWGGeometry.</code> 
This method offers a choice of several
calling conventions, ranging from simplest to most powerful.
But before we can discuss these we need to recall a 
peculiarity of the SIE/BEM approach to scattering problems.</p>
<h3 id="selecting-the-incident-scattered-or-total-fields">Selecting the Incident, Scattered, or Total Fields</h3>
<p>To understand the calling convention for <code class="codehilite">GetFields</code>, we 
must first remember that in an SIE/BEM scattering problem 
there are three types of fields we can compute:</p>
<ul>
<li>
<p>the <em>incident</em> fields, which depend on the <code class="codehilite">IncField</code> object passed to <code class="codehilite">AssembleRHSVector,</code></p>
</li>
<li>
<p>the <em>scattered</em> fields, which depend on the <code class="codehilite">HVector</code> object obtained by solving the linear BEM system, and </p>
</li>
<li>
<p>the <em>total</em> fields, representing the sum of incident and scattered contributions.</p>
</li>
</ul>
<p>Thus the first two parameters to <code class="codehilite">GetFields</code> are 
an <code class="codehilite">IncField</code> pointer and an <code class="codehilite">HVector</code> pointer:</p>
<div class="codehilite"><pre><span></span><span class="n">RWGGeometry</span><span class="o">::</span><span class="n">GetFields</span><span class="p">(</span> <span class="k">const</span> <span class="n">IncField</span> <span class="o">*</span><span class="n">IF</span><span class="p">,</span> <span class="k">const</span> <span class="n">HVector</span> <span class="o">*</span><span class="n">KN</span><span class="p">,</span> <span class="p">...</span> <span class="cm">/* other arguments */</span> 
</pre></div>

<p>Here <code class="codehilite">IF</code> should be the same <code class="codehilite">IncField</code> pointer you passed to <code class="codehilite">AssembleRHSVector</code>, while <code class="codehilite">KN</code> 
should be the solution to the BEM system, as computed (for instance)
by saying something like <code class="codehilite">M-&gt;LUSolve(KN).</code></p>
<p>You can select the type of field computed by <code class="codehilite">GetFields</code> by 
passing <code class="codehilite">NULL</code> values for one of these parameters to omit 
the corresponding field contributions. More specifically,</p>
<ul>
<li>
<p>If you pass <code class="codehilite">NULL</code> for the <code class="codehilite">KN</code> argument, the fields computed will be the <em>incident</em> fields.</p>
</li>
<li>
<p>If you pass <code class="codehilite">NULL</code> for the <code class="codehilite">IF</code> argument, the fields computed will be the <em>scattered</em> fields.</p>
</li>
<li>
<p>If you pass non-<code class="codehilite">NULL</code> values for both arguments, the fields computed will be the <em>total</em> fields.</p>
</li>
</ul>
<p>Note that the term "scattered fields" is actually somewhat imprecise,
because the fields arising from the surface currents are in fact the 
<em>total</em> fields in regions that do not contain field sources.
For example, consider a compact dielectric object irradiated by 
a plane wave. Outside the object, we have an incident field<br />
(the field of the plane wave) and a scattered field (the field arising 
from the surface currents on the sphere), and the total field is 
the sum of these two contributions.
However, inside the object we have <em>only</em> the contributions 
of the surface currents; the field arising from these currents
is already the total field inside the sphere with no contribution
from the incident field. For evaluation points inside the object, 
the scattered and total fields as computed by <code class="codehilite">GetFields</code> 
are identical, while the incident field is zero.</p>
<h4 id="field-components-at-a-single-point">Field components at a single point</h4>
<p>The simplest way to use <code class="codehilite">GetFields</code> is to compute the
Cartesian components of the <strong>E</strong> and <strong>H</strong> fields
at a single point <strong>x.</strong> The function prototype in this case 
is </p>
<div class="codehilite"><pre><span></span><span class="n">RWGGeometry</span><span class="o">::</span><span class="n">GetFields</span><span class="p">(</span> <span class="k">const</span> <span class="n">IncField</span> <span class="o">*</span><span class="n">IF</span><span class="p">,</span>
                        <span class="k">const</span> <span class="n">HVector</span> <span class="o">*</span><span class="n">KN</span><span class="p">,</span> 
                        <span class="k">const</span> <span class="n">cdouble</span> <span class="n">Omega</span><span class="p">,</span> 
                        <span class="k">const</span> <span class="kt">double</span> <span class="n">X</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                        <span class="n">cdouble</span> <span class="n">EH</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="p">);</span>
</pre></div>

<p>where the additional inputs beyond those discussed above are</p>
<ul>
<li><code class="codehilite">Omega:</code> the angular frequency</li>
<li><code class="codehilite">X</code>: the cartesian components of the evaluation point</li>
<li><code class="codehilite">KN:</code> the surface-current expansion vector</li>
</ul>
<p>and, on return, the output vector <code class="codehilite">EH</code> contains
the field components:</p>
<ul>
<li><code class="codehilite">EH[0..2]</code> are the cartesian components of the 
                          scattered <strong>E</strong> field, </li>
<li><code class="codehilite">EH[3..5]</code> are the cartesian components of the </li>
</ul>
<h4 id="scattered-field-components-at-multiple-points">Scattered field components at multiple points</h4>
<p>To compute the scattered-field components at <em>N</em> evaluation points, 
you could just repeat the above procedure <em>N</em> times, but you will
get better throughput by first
[creating an <code class="codehilite">HMatrix</code>][MatrixVector]
of dimension <em>N x 3</em>, whose rows are the Cartesian components
of the evaluation points, and then passing this <code class="codehilite">HMatrix</code> in
place of the <code class="codehilite">X</code> parameter to <code class="codehilite">GetFields:</code></p>
<div class="codehilite"><pre><span></span><span class="n">HMatrix</span> <span class="o">*</span><span class="n">RWGGeometry</span><span class="o">::</span><span class="n">GetFields</span><span class="p">(</span> <span class="k">const</span> <span class="n">IncField</span> <span class="o">*</span><span class="n">IF</span><span class="p">,</span>
                                 <span class="k">const</span> <span class="n">HVector</span> <span class="o">*</span><span class="n">KN</span><span class="p">,</span> 
                                 <span class="k">const</span> <span class="n">cdouble</span> <span class="n">Omega</span><span class="p">,</span> 
                                 <span class="k">const</span> <span class="n">HMatrix</span> <span class="o">*</span><span class="n">XMatrix</span><span class="p">,</span>
                                 <span class="n">HMatrix</span> <span class="o">*</span><span class="n">FMatrix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>

<p>In this case, the return value is a newly allocated <code class="codehilite">HMatrix</code>
of dimension <em>N x 6</em>, whose rows are the cartesian components 
of the scattered fields at your evaluation points, in the order
Ex, Ey, Ez, Hx, Hy, Hz. (If you already have a matrix of the correct
size lying around, perhaps from a previous call to <code class="codehilite">GetFields</code>,
you can pass it as the <code class="codehilite">FMatrix</code> parameter to suppress allocation
of a new <code class="codehilite">HMatrix</code>).</p>
<p>In <span class="SC">python</span>, you can create 
an <em>N</em>x3 <code class="codehilite">XMatrix</code> either by reading from a text 
file (containing the three cartesian coordinates of each evaluation 
point on a separate line, with blank lines and lines beginning with 
<code class="codehilite">#</code> ignored):</p>
<div class="codehilite"><pre><span></span> <span class="n">X</span><span class="o">=</span><span class="n">scuff</span><span class="o">.</span><span class="n">HMatrix</span><span class="p">(</span><span class="s2">&quot;MyEvalPointFile&quot;</span><span class="p">)</span>

 <span class="n">Fields</span><span class="o">=</span><span class="n">G</span><span class="o">.</span><span class="n">GetFields</span><span class="p">(</span><span class="n">PW</span><span class="p">,</span> <span class="n">KN</span><span class="p">,</span> <span class="n">Omega</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>

 <span class="c1"># now we have Fields[0][0..5] = (Ex,Ey,Ez,Hx,Hy,Hz) at point 1 </span>
 <span class="c1">#                   [1][0..5] = (Ex,Ey,Ez,Hx,Hy,Hz) at point 2 </span>
 <span class="c1"># etc. </span>
</pre></div>

<p>or by creating an <code class="codehilite">XMatrix</code> of size <em>N x 3</em> and<br />
setting the entries by hand. For example, if we want the fields at 
two evaluation points with coordinates <code class="codehilite">(0.1,0.2,0.3)</code> 
and <code class="codehilite">(0.4,0.5,0.6)</code>, we can say</p>
<div class="codehilite"><pre><span></span> <span class="n">X</span><span class="o">=</span><span class="n">scuff</span><span class="o">.</span><span class="n">HMatrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1"># for 2 eval points </span>

 <span class="n">X</span><span class="o">-&gt;</span><span class="n">SetEntry</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span> <span class="p">);</span> <span class="c1"># x coord of first point </span>
 <span class="n">X</span><span class="o">-&gt;</span><span class="n">SetEntry</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="p">);</span> <span class="c1"># y coord of first point </span>
 <span class="n">X</span><span class="o">-&gt;</span><span class="n">SetEntry</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.3</span> <span class="p">);</span> <span class="c1"># z coord of first point</span>

 <span class="n">X</span><span class="o">-&gt;</span><span class="n">SetEntry</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span> <span class="p">);</span> <span class="c1"># x coord of second point </span>
 <span class="n">X</span><span class="o">-&gt;</span><span class="n">SetEntry</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span> <span class="p">);</span> <span class="c1"># y coord of second point </span>
 <span class="n">X</span><span class="o">-&gt;</span><span class="n">SetEntry</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.6</span> <span class="p">);</span> <span class="c1"># z coord of second point</span>

 <span class="n">Fields</span><span class="o">=</span><span class="n">G</span><span class="o">.</span><span class="n">GetFields</span><span class="p">(</span><span class="n">PW</span><span class="p">,</span> <span class="n">KN</span><span class="p">,</span> <span class="n">Omega</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>

 <span class="c1"># now we have Fields[0][0..5] = (Ex,Ey,Ez,Hx,Hy,Hz) at point 1 </span>
 <span class="c1">#                   [1][0..5] = (Ex,Ey,Ez,Hx,Hy,Hz) at point 2 </span>
 <span class="c1"># etc. </span>
</pre></div>

<p>Alternatively, you can create <code class="codehilite">X</code> as a <code class="codehilite">numpy.array:</code> </p>
<div class="codehilite"><pre><span></span> <span class="n">X</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]]);</span>

 <span class="n">Fields</span><span class="o">=</span><span class="n">G</span><span class="o">.</span><span class="n">GetFields</span><span class="p">(</span><span class="n">PW</span><span class="p">,</span> <span class="n">KN</span><span class="p">,</span> <span class="n">Omega</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
</pre></div>

<p>Note that, when constructed as a <code class="codehilite">numpy.array</code>, 
<code class="codehilite">X</code> must have "shape" <code class="codehilite">(3,N)</code>, 
not <code class="codehilite">(N,3)</code> as you might expect.</p>
                
                  
                
              
              
                



  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "http://homerreid.github.io/scuff-em-documentation/API/MainFlow/";
      this.page.identifier =
        "/API/MainFlow/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//homerreid-github-io-scuff-em-documentation.disqus.com.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../libscuff/" title="libscuff" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                libscuff
              </span>
            </div>
          </a>
        
        
          <a href="../UtilityAPI/" title="Utility API" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Utility API
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b438e6c5.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:"../.."}})</script>
      
        <script src="../../javascripts/MathJax.js?config=TeX-AMS_HTML"></script>
      
        <script src="../../javascripts/mathjaxhelper.js"></script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-119340518-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>